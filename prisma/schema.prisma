// Civic Tech - Complaint tracking system

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum IssueCategory {
    CORRUPTION
    POTHOLE
    WATER
    ELECTRICITY
    DOMESTIC_VIOLENCE
    CRIME
    SANITATION
    EDUCATION
    HEALTHCARE
    ENVIRONMENT
    OTHER
}

enum IssueStatus {
    REPORTED
    ACKNOWLEDGED
    IN_PROGRESS
    RESOLVED
    CLOSED
}

model Issue {
    id        String   @id @default(cuid())
    title     String
    description String
    category  IssueCategory
    status    IssueStatus @default(REPORTED)
    
    // Geospatial
    latitude  Float
    longitude Float
    state     String
    city      String
    area      String?
    pincode   String?
    
    // Media
    imageUrls String[] // Array of image URLs
    
    // Metadata
    createdBy String   // User ID
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    
    // Relations
    communityNotes CommunityNote[]
    upvotes   Int @default(0)
    
    @@index([status])
    @@index([category])
    @@index([state])
    @@index([city])
    @@index([createdAt])
}

model CommunityNote {
    id        String   @id @default(cuid())
    content   String
    
    // Rating
    helpful   Int @default(0)
    notHelpful Int @default(0)
    rating    String? // "HELPFUL", "PARTIALLY_HELPFUL", "NOT_HELPFUL"
    
    // Relations
    issueId   String
    issue     Issue @relation(fields: [issueId], references: [id], onDelete: Cascade)
    createdBy String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    
    @@index([issueId])
    @@index([createdBy])
}

model IssueUpvote {
    id        String   @id @default(cuid())
    issueId   String
    userId    String
    createdAt DateTime @default(now())
    
    @@unique([issueId, userId])
    @@index([issueId])
}

model Post {
    id        Int      @id @default(autoincrement())
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}
